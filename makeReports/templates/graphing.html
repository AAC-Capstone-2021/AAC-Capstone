{% extends 'base.html' %}
{% load bootstrap4 %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
<script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
<script type='text/javascript'></script>
<div id="vapp">
{% endblock %}
{% block styles %}
<meta charset='utf-8' />
<link
type="text/css"
rel="stylesheet"
href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"
/>
<link
type="text/css"
rel="stylesheet"
href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
/> 
{% endblock %}
{% block content %}
<h3>Historical Data</h3>
{% if user.profile.aac %}
    <h4>Please choose your college</h4>
    <div class="dd_col">
        <select id="id_college" v-model="college" v-on:change="updateDept" name="college">
            {% for c in colleges %}
                <option value="{{c.pk}}">{{ c.name }}</option>
            {% endfor %}
        </select>
    </div>
    <h4>Please choose your department</h4>
    <div class="dd_dept">
        <select id="id_department" v-model="department" v-on:change="updateProg" name="department">
            <template v-for="d in depts">
                    <option v-bind:value="d.pk">[[d.name]]</option>
            </template>
        </select>
    </div>
{% endif %}
<h4>Please choose your desired degree program</h4>
<div class="dd_dprog">
    <select id="id_prog" v-model="program" name="program">
            <option value="1">All Programs</option>
        <template v-for="p in progs">
            <option v-bind:value="p.pk">[[p.name]] ([[p.level]])</option>
        </template>
    </select>
</div>
<h4>Date Range</h4>
<div class="dd_drange1">
    <select id="id_range1" v-model="date1"></select>
</div>
<h5>to</h5>
<div class="dd_drange2">
    <select id="id_range2" v-model="date2"></select>
</div>
<h4>What would you like to see graphed?</h4>
<template v-if="program == 1">
    <div class="dd_graph">
        <select id="id_graph" v-model="graph_opt">
            <option value="3">Number of degree programs meeting target</option>
        </select>
    </div>
</template>
<template v-if="program != 1">
    <div class="dd_graph">
        <select id="id_graph" v-model="graph_opt" v-on:change="updateSLOs">
            <option value="1">Specific SLO: target vs actual</option>
            <option value="2">Number of SLO's met</option>
        </select>
    </div>
</template>
<template v-if="graph_opt == 1">
    <h4>Pick the SLO you would like to see graphed</h4>
    <div class="specific">
        <select id="spec" v-model="slo">
            <template v-for="s in slos">
                <option v-bind:value="s.pk">[[s.goalText]]</option>
            </template>
        </select>
    </div>
</template>
<button v-on:click="newGraph()">View Graph</button> 
{% endblock %}
{% block endscripts %}
    <script>
    var start = 2015;
    var end = new Date().getFullYear();
    var options = "";
    for (var year = end; year >= start; year--)
    {
        options += "<option>"+ year + "</option>";
    }
    document.getElementById("id_range1").innerHTML = options;
    document.getElementById("id_range2").innerHTML = options;
    var vapp=new Vue({
            el: '#vapp',
            delimiters: ['[[', ']]'],
            data: { 
                depts: null,
                progs: null,
                slos: null,
                graph_opt: 1,
                department: null,
                college: null,
                program: 1,
                date1: null,
                date2: null,
                slo: null
            },
            computed: {
            },
            methods: {
                updateDept: function () {
                    fetch("{% url 'makeReports:api-dept-by-col' %}?college="+this.college)
                        .then(response => {
                            response.clone().json()
                        .then(json => {
                            this.depts = json;
                        })
                    });
                },
                updateProg: function() {
                    fetch("{% url 'makeReports:api-prog-by-dept' %}?department="+this.department)
                        .then(response => {
                            response.clone().json()
                        .then(json => {
                            this.progs = json;
                        })
                    });
                },
                updateSLOs: function() {
                    fetch("{% url 'makeReports:api-slo-by-dp' %}?report__degreeProgram="+this.program
                    +"&report__year__gte="+this.date1+"&report__year__lte="+this.date2)
                        .then(response => {
                            response.clone().json()
                        .then(json => {
                            this.slos = json;
                        })
                    });
                },
                newGraph: function() {
                    fetch("{% url 'makeReports:api-new-graph' %}?report__degreeProgram__department="
                    +this.department+"&report__degreeProgram="+this.program+"&report__year__gte="+this.date1+
                    "&report__year__lte="+this.date2+"&decision="+this.graph_opt+"&sloIR__slo="+this.slo)
                        .then(repsonse => {
                            response.clone().json()
                        .then(json => {
                            this.url = json;
                        })
                    })
                }
            }
    });
    </script>
{% endblock %}