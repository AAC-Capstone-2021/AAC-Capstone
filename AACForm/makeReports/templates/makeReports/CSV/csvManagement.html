{% extends 'base.html' %}
{% load bootstrap4 %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="//unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
<script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
<script type='text/javascript'></script>
<div id="vapp">
{% endblock %}
{% block styles %}
<meta charset='utf-8' />
<link
type="text/css"
rel="stylesheet"
href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"
/>
<link
type="text/css"
rel="stylesheet"
href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
/> 
{% endblock %}
{% block content %}
<h3>CSV Generator</h3>
{% if user.profile.aac %}
    <h4>CHoose scope of CSV</h4>
    <div class="dd_graph">
        <select id="id_csv_scope" v-model="csv_scope">
            <option value="1">Degree Program</option>
            <option value="2">Department</option>
            <option value="3">College</option>
        </select>
    </div>
    <template v-if="csv_scope==3">
        <h4>Please choose college</h4>
        <div class="dd_col">
            <select id="id_college" v-model="college" v-on:change="updateDept" name="college">
                {% for c in colleges %}
                    <option value="{{c.pk}}">{{ c.name }}</option>
                {% endfor %}
            </select>
        </div>
    </template>
    <template v-if="csv_scope==2">
    <h4>Please choose department</h4>
    <div class="dd_dept">
        <select id="id_department" v-model="department" v-on:change="updateProg" name="department">
            <template v-for="d in depts">
                    <option v-bind:value="d.pk">[[d.name]]</option>
            </template>
        </select>
    </div>
    </template>
{% endif %}
<template v-if="csv_scope==1">
<h4>Please choose desired degree program</h4>
<div class="dd_dprog">
    <select id="id_prog" v-model="program" v-on:change="updateSLOs" name="program">
        <template v-for="p in progs">
            <option v-bind:value="p.pk">[[p.name]] ([[p.level]])</option>
        </template>
    </select>
</div>
</template>
<h4>Date Range</h4>
<div class="dd_drange1">
    <select id="id_range1"></select>
</div>
<h5>to</h5>
<div class="dd_drange2">
    <select id="id_range2"></select>
</div>

<a role="button" class="btn btn-primary" :href=csvLink>Generate CSV</button> 
{% endblock %}
{% block endscripts %}
    <script>
    var start = 2015;
    var end = new Date().getFullYear();
    var options = "";
    for (var year = start; year <= end; year++)
    {
        yearMinus = year-1;
        options += "<option value=\""+year+"\">"+ yearMinus+"-" + year + "</option>";
    }
    document.getElementById("id_range1").innerHTML = options;
    document.getElementById("id_range2").innerHTML = options;
    var vapp=new Vue({
            el: '#vapp',
            delimiters: ['[[', ']]'],
            data: { 
                depts: null,
                progs: null,
                slos: null,
                csv_scope: 1,
                department: null,
                college: null,
                program: null,
            },
            computed: {
            },
            methods: {
                updateDept: function () {
                    fetch("{% url 'makeReports:api-dept-by-col' %}?college="+this.college)
                        .then(response => {
                            response.clone().json()
                        .then(json => {
                            this.depts = json;
                        })
                    });
                },
                updateProg: function() {
                    fetch("{% url 'makeReports:api-prog-by-dept' %}?department="+this.department)
                        .then(response => {
                            response.clone().json()
                        .then(json => {
                            this.progs = json;
                        })
                    });
                },
                updateSLOs: function() {
                    fetch("{% url 'makeReports:api-slo-by-dp' %}?program="+this.program)
                        .then(response => {
                            response.clone().json()
                        .then(json => {
                            this.slos = json;
                        })
                    });
                }
            }
    });
    function newGraph(){
        
    }
    </script>
{% endblock %}