{% extends 'form_entry_base.html' %}
{% load bootstrap4 %}
{% load static %}
{% block in_scripts %}
{% endblock %}
{% block inner_content %}
{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js"
    integrity="sha512-n/4gHW3atM3QqRcbCn6ewmpxcLAHGaDjpEBu4xZd47N0W2oQ+6q7oc3PXstrJYXcbNU1OHdQ1T7pAP+gi5Yu8g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type='text/javascript'>
    /**
     * Creates the drop-down for the year
     * @class importSLO
     */
    /**
     * Creates drop down for year and updates upon the DOM being loaded
     * @method onLoad
     */
    document.addEventListener("DOMContentLoaded", function () {
        getYears();
    });

    /**
     * Calls the API to update the year choices for the search,
     * based upon the currently selected degree program
     * @method updateYears
     */
    function getYears(event) {
        try {
            const e = document.getElementById("dp");
            const dP = e.options[e.selectedIndex].value;
            const year = document.getElementById("year");
            while (year.options.length > 0) {
                year.remove(0);
            }
            $.ajax({
                type: "GET",
                url: "/api/import/years/",
                data: {
                    "pk": dP
                },
                success: function (response) {
                    const items = response;
                    for(let i = 0; i < items.length; i++) 
                    {
                        const opt = items[i].value;
                        const el = document.createElement("option");
                        el.textContent = opt;
                        el.value = opt;
                        year.appendChild(el);
                        sortSelect(year);
                    }
                    
                },
                error: function (response) {
                    console.log("ERROR");
                }
            });
        } catch (err) {
            console.error(err);
        }
    }

    function sortSelect(selElem) {
        const tmpAry = new Array();
        for (let i=0;i<selElem.options.length;i++) {
            tmpAry[i] = new Array();
            tmpAry[i][0] = selElem.options[i].text;
            tmpAry[i][1] = selElem.options[i].value;
        }
        tmpAry.sort();
        while (selElem.options.length > 0) {
            selElem.options[0] = null;
        }
        for (let i=0;i<tmpAry.length;i++) {
            const op = new Option(tmpAry[i][0], tmpAry[i][1]);
            selElem.options[i] = op;
        }
        return;
    }

</script>
{% endblock %}
<h3>Import Assessment Supplement</h3>
<h5>Search From Past Reports</h5>
<form action="{% url 'makeReports:assessment-supplement-import' report=rpt.pk assessIR=aIR%}" type="get">
        <!--<input id="name" type="text" name="name"></div>-->
        <div> 
            <label>Degree Program: </label>
             <select id = "dp" name="dp" required onchange="getYears()">
                {% for degPro in degPro_list %}
                    <option value = "{{degPro.pk}}" {% if degPro.pk is currentDPpk %}selected{% endif %}>{{degPro.name}}</option>
               {% endfor %}
             </select>
        </div>
        <div style="max-width:200px"><label>Year:</label> 
            <select id="year" name="year" required>
            </select>
        </div>
        {% buttons %}
        <button type="submit" class="btn btn-primary">Search</button>
        {% endbuttons %}
</form>
<h5>Select Supplement to Import</h5>
<form method="post" class="form col-6" enctype="multipart/form-data">
    {% csrf_token %}
    {% bootstrap_form form %}
    {% buttons %}
        <button type="submit" class="btn btn-primary">Import</button>
    {% endbuttons %}
</form>
{% endblock %}